<div class="gate-pass-container">
  <form [formGroup]="gatePassForm" (ngSubmit)="onSubmit()">
    <!-- Header Section -->
    <div class="header-section">
      <div class="logo-section">
        <!-- <div class="logo">LOGO</div> -->
        <h2 class="gate-pass-title">GATE PASS</h2>
      </div>

      <!-- <div class="company-info">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Company Name</mat-label>
          <label>Dolphin International</label>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Address</mat-label>
          <label>AP Puttageri Tq : Kusngi, Dt Koppai</label>
        </mat-form-field>
      </div> -->
    </div>

    <!-- Gate Pass Info Section -->
    <div class="gatepass-info-section form-row">
      <mat-form-field appearance="outline">
        <mat-label>Gate Pass No</mat-label>
        <input matInput formControlName="gatePassNo" readonly />
        <mat-error *ngIf="isFieldInvalid('gatePassNo')">
          {{ getFieldErrorMessage("gatePassNo") }}
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Dispatch Date</mat-label>
        <input
          matInput
          [matDatepicker]="picker"
          formControlName="dispatchDate"
        />
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
        <mat-error *ngIf="isFieldInvalid('dispatchDate')">
          {{ getFieldErrorMessage("dispatchDate") }}
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Bill To Section -->
    <div class="bill-to-section">
      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Bill To</mat-label>
          <mat-select
            formControlName="billTo"
            (selectionChange)="onClientChange($event.value)"
          >
            <mat-option value="">Select Client</mat-option>
            <mat-option *ngFor="let type of clients" [value]="type.clientName">
              {{ type.clientName }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="isFieldInvalid('billTo')">
            {{ getFieldErrorMessage("billTo") }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Country</mat-label>
          <input matInput formControlName="country" readonly />
          <mat-error *ngIf="isFieldInvalid('country')">
            {{ getFieldErrorMessage("country") }}
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Bill To Address</mat-label>
          <input matInput formControlName="billToAddress" readonly />
          <mat-error *ngIf="isFieldInvalid('billToAddress')">
            {{ getFieldErrorMessage("billToAddress") }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>GP Type</mat-label>
          <mat-select formControlName="gpType">
            <mat-option value="">Select GP Type</mat-option>
            <mat-option *ngFor="let type of gpTypes" [value]="type.gp">
              {{ type.gp }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="isFieldInvalid('gpType')">
            {{ getFieldErrorMessage("gpType") }}
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>GSTIN</mat-label>
          <input matInput formControlName="gstin" readonly />
          <mat-error *ngIf="isFieldInvalid('gstin')">
            {{ getFieldErrorMessage("gstin") }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Phone</mat-label>
          <input matInput formControlName="phone" />
          <mat-error *ngIf="isFieldInvalid('phone')">
            {{ getFieldErrorMessage("phone") }}
          </mat-error>
        </mat-form-field>
      </div>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Place of Dispatch</mat-label>
        <input matInput formControlName="placeOfDispatch" />
        <mat-error *ngIf="isFieldInvalid('placeOfDispatch')">
          {{ getFieldErrorMessage("placeOfDispatch") }}
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Additional Fields Section -->
    <div class="additional-fields-section">
      <h3>Additional Information</h3>
      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>HSN/SAC</mat-label>
          <mat-select formControlName="hsn">
            <mat-option value="">Select HSN</mat-option>
            <mat-option *ngFor="let hsn of hsnOptions" [value]="hsn.value">
              {{ hsn.label }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="isFieldInvalid('hsn')">
            {{ getFieldErrorMessage("hsn") }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Permit No</mat-label>
          <input matInput formControlName="permitNo" />
          <mat-error *ngIf="isFieldInvalid('permitNo')">
            {{ getFieldErrorMessage("permitNo") }}
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>E-Way Bill No</mat-label>
          <input matInput formControlName="ewayBillNo" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Buyer's Order Number</mat-label>
          <input matInput formControlName="buyersOrderNumber" />
        </mat-form-field>
      </div>
      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>E-Way Bill No</mat-label>
          <input matInput formControlName="ewayBillNo" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Buyer's Order Number</mat-label>
          <input matInput formControlName="buyersOrderNumber" />
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Supplier Ref</mat-label>
          <input matInput formControlName="supplierRef" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Other Reference</mat-label>
          <input matInput formControlName="otherReference" />
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Dispatched Through</mat-label>
          <input matInput formControlName="dispatchedThrough" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Destination</mat-label>
          <input matInput formControlName="destination" />
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Terms of Payment</mat-label>
          <mat-select formControlName="termsOfPayment">
            <mat-option
              *ngFor="let option of termsOfPaymentOptions"
              [value]="option.value"
            >
              {{ option.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Other Reference (Alt)</mat-label>
          <input matInput formControlName="otherrefence" />
        </mat-form-field>
      </div>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Delivery Note Date</mat-label>
        <input
          matInput
          [matDatepicker]="deliveryDatePicker"
          formControlName="deliveryNoteDate"
        />
        <mat-datepicker-toggle
          matSuffix
          [for]="deliveryDatePicker"
        ></mat-datepicker-toggle>
        <mat-datepicker #deliveryDatePicker></mat-datepicker>
      </mat-form-field>
    </div>

    <!-- Transporter Section -->
    <div class="transporter-section">
      <h3>Transporter Information</h3>

      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Transporter Phone</mat-label>
          <input matInput formControlName="tansporterContactNo" />
          <mat-error *ngIf="isFieldInvalid('tansporterContactNo')">
            {{ getFieldErrorMessage("tansporterContactNo") }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Vehicle No</mat-label>
          <input matInput formControlName="vehicleNo" />
          <mat-error *ngIf="isFieldInvalid('vehicleNo')">
            {{ getFieldErrorMessage("vehicleNo") }}
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Driver Name</mat-label>
          <input matInput formControlName="driverName" />
          <mat-error *ngIf="isFieldInvalid('driverName')">
            {{ getFieldErrorMessage("driverName") }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Driver Contact No</mat-label>
          <input matInput formControlName="driverContactNo" />
          <mat-error *ngIf="isFieldInvalid('driverContactNo')">
            {{ getFieldErrorMessage("driverContactNo") }}
          </mat-error>
        </mat-form-field>
      </div>
    </div>

    <!-- Items Section -->
    <div class="items-section">
      <div class="section-header">
        <h3>Items</h3>
        <div class="form-row">
          <mat-form-field appearance="outline" class="multi-block-selector">
            <mat-label>Select Blocks to Add</mat-label>
            <mat-select
              multiple
              [(value)]="selectedBlockNos"
              (selectionChange)="onBlocksSelected()"
            >
              <mat-option
                *ngFor="let block of graniteBlocks"
                [value]="block.blockNo"
              >
                {{ block.blockNo }} - {{ block.categoryGrade }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>

      <!-- Items table -->
      <div class="items-table-container">
        <table class="items-table">
          <thead>
            <tr>
              <th>SR No</th>
              <th>Block No</th>
              <th>Item Description</th>
              <th>Category/Grade</th>
              <th>Measurement</th>
              <th>Net Weight Mt</th>
              <th>Quarry CBM</th>
              <th>UOM</th>
              <th>DMG Tonnage</th>
              <th>Net CBM</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody formArrayName="graniteStocks">
            <tr
              *ngFor="let item of items.controls; let i = index"
              [formGroupName]="i"
            >
              <td>{{ i + 1 }}</td>
              <td>
                <mat-form-field appearance="outline" class="disabled-field">
                  <input matInput formControlName="blockNo" readonly />
                  <mat-error *ngIf="isItemFieldInvalid(i, 'blockNo')"
                    >Required</mat-error
                  >
                </mat-form-field>
              </td>
              <td>
                <mat-form-field appearance="outline">
                  <input matInput formControlName="itemDescription" />
                  <mat-error *ngIf="isItemFieldInvalid(i, 'itemDescription')"
                    >Required</mat-error
                  >
                </mat-form-field>
              </td>
              <td>
                <mat-form-field appearance="outline">
                  <input matInput formControlName="categoryGrade" />
                  <mat-error *ngIf="isItemFieldInvalid(i, 'categoryGrade')"
                    >Required</mat-error
                  >
                </mat-form-field>
              </td>
              <!-- Measurement cells remain the same -->
              <td formGroupName="measurement">
                <div class="measurement-group">
                  <mat-form-field appearance="outline" class="disabled-field">
                    <input
                      matInput
                      placeholder="LG"
                      formControlName="lg"
                      type="number"
                      readonly
                    />
                  </mat-form-field>
                  <mat-form-field appearance="outline" class="disabled-field">
                    <input
                      matInput
                      placeholder="WD"
                      formControlName="wd"
                      type="number"
                      readonly
                    />
                  </mat-form-field>
                  <mat-form-field appearance="outline" class="disabled-field">
                    <input
                      matInput
                      placeholder="HT"
                      formControlName="ht"
                      type="number"
                      readonly
                    />
                  </mat-form-field>
                </div>
              </td>
              <td formGroupName="measurement">
                <mat-form-field appearance="outline" class="disabled-field">
                  <input
                    matInput
                    formControlName="netWeightMt"
                    type="number"
                    readonly
                  />
                  <mat-error
                    *ngIf="isItemFieldInvalid(i, 'measurement.netWeightMt')"
                    >Required</mat-error
                  >
                </mat-form-field>
              </td>
              <!-- Continue with other cells, HSN and Permit No removed -->
              <td>
                <mat-form-field appearance="outline" class="disabled-field">
                  <input
                    matInput
                    formControlName="quarryCbm"
                    type="number"
                    readonly
                  />
                  <mat-error *ngIf="isItemFieldInvalid(i, 'quarryCbm')"
                    >Required</mat-error
                  >
                </mat-form-field>
              </td>
              <td>
                <mat-form-field appearance="outline">
                  <input matInput formControlName="uom" />
                  <mat-error *ngIf="isItemFieldInvalid(i, 'uom')"
                    >Required</mat-error
                  >
                </mat-form-field>
              </td>
              <td>
                <mat-form-field appearance="outline" class="disabled-field">
                  <input
                    matInput
                    formControlName="dmgTonnage"
                    type="number"
                    readonly
                  />
                  <mat-error *ngIf="isItemFieldInvalid(i, 'dmgTonnage')"
                    >Required</mat-error
                  >
                </mat-form-field>
              </td>
              <td>
                <mat-form-field appearance="outline" class="disabled-field">
                  <input
                    matInput
                    formControlName="netCbm"
                    type="number"
                    readonly
                  />
                  <mat-error *ngIf="isItemFieldInvalid(i, 'netCbm')"
                    >Required</mat-error
                  >
                </mat-form-field>
              </td>
              <td>
                <button
                  mat-icon-button
                  color="warn"
                  type="button"
                  (click)="removeItem(i)"
                >
                  <mat-icon>delete</mat-icon>
                </button>
              </td>
            </tr>
          </tbody>
          <tfoot>
            <tr class="totals-row">
              <td colspan="5" class="totals-label"><strong>TOTALS:</strong></td>
              <td class="totals-value">
                <strong>{{ calculateTotals().totalNetWeightMt }}</strong>
                <!-- NEW -->
              </td>
              <td class="totals-value">
                <strong>{{ calculateTotals().totalQuarryCbm }}</strong>
              </td>
              <td></td>

              <td class="totals-value">
                <strong>{{ calculateTotals().totalDmgTonnage }}</strong>
              </td>
              <td class="totals-value">
                <strong>{{ calculateTotals().totalNetCbm }}</strong>
              </td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>

    <!-- Notes -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Notes</mat-label>
      <textarea matInput formControlName="notes" rows="3"></textarea>
    </mat-form-field>

    <!-- Footer -->
    <div class="footer-section form-row">
      <mat-form-field appearance="outline">
        <mat-label>Prepared By</mat-label>
        <input matInput readonly />
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Authorised Signatory</mat-label>
        <input matInput readonly />
      </mat-form-field>
    </div>

    <!-- Submit Buttons -->
    <div class="submit-section">
      <button
        mat-raised-button
        color="primary"
        type="submit"
        [disabled]="gatePassForm.invalid"
      >
        Submit Gate Pass
      </button>
      <button
        mat-stroked-button
        color="warn"
        type="button"
        (click)="gatePassForm.reset()"
      >
        Reset
      </button>
    </div>
  </form>
</div>
